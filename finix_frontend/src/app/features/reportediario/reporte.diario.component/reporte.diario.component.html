<div class="p-4 sm:p-8 bg-gray-50 min-h-screen">
    <h1 class="text-2xl font-bold text-gray-800 mb-6">Reporte Diario y Cierre de Caja</h1>

    <mat-card class="mb-8">
        <mat-card-content class="pt-4 flex flex-wrap items-center gap-4">
            <mat-form-field appearance="fill" class="flex-grow">
                <mat-label>Selecciona un rango de fechas</mat-label>
                <mat-date-range-input [formGroup]="range" [rangePicker]="picker">
                    <input matStartDate formControlName="start" placeholder="Fecha inicio">
                    <input matEndDate formControlName="end" placeholder="Fecha fin">
                </mat-date-range-input>
                <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-date-range-picker #picker></mat-date-range-picker>
            </mat-form-field>
            <button mat-flat-button color="primary" (click)="buscarReporte()" class="h-14">
                <mat-icon>search</mat-icon>
                Buscar
            </button>
        </mat-card-content>
    </mat-card>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <mat-card class="text-center bg-green-100">
            <mat-card-header><mat-card-title>+ Total Ventas</mat-card-title></mat-card-header>
            <mat-card-content><p class="text-3xl font-bold text-green-800">{{ totalVentas() | currency:'COP':'symbol':'1.0-0' }}</p></mat-card-content>
        </mat-card>
        <mat-card class="text-center bg-red-100">
            <mat-card-header><mat-card-title>- Total Compras</mat-card-title></mat-card-header>
            <mat-card-content><p class="text-3xl font-bold text-red-800">{{ totalCompras() | currency:'COP':'symbol':'1.0-0' }}</p></mat-card-content>
        </mat-card>
        <mat-card class="text-center bg-red-100">
            <mat-card-header><mat-card-title>- Total Egresos</mat-card-title></mat-card-header>
            <mat-card-content><p class="text-3xl font-bold text-red-800">{{ totalEgresos() | currency:'COP':'symbol':'1.0-0' }}</p></mat-card-content>
        </mat-card>
        <mat-card class="text-center bg-blue-100">
            <mat-card-header><mat-card-title>= Total en Caja</mat-card-title></mat-card-header>
            <mat-card-content><p class="text-3xl font-bold text-blue-800">{{ totalEnCaja() | currency:'COP':'symbol':'1.0-0' }}</p></mat-card-content>
        </mat-card>
    </div>

    @if (isLoading()) {
      <div class="flex justify-center items-center p-8"><mat-progress-spinner mode="indeterminate"></mat-progress-spinner></div>
    }

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <div>
            <h2 class="text-xl font-semibold mb-4">Detalle de Ventas</h2>
            <div class="mat-elevation-z2 rounded-lg overflow-hidden bg-white">
                <table mat-table [dataSource]="ventas()">
                    <ng-container matColumnDef="id"><th mat-header-cell *matHeaderCellDef>ID</th><td mat-cell *matCellDef="let item">#{{item.id}}</td></ng-container>
                    <ng-container matColumnDef="fecha"><th mat-header-cell *matHeaderCellDef>Fecha</th><td mat-cell *matCellDef="let item">{{item.fecha | date:'short'}}</td></ng-container>
                    <ng-container matColumnDef="totalVenta"><th mat-header-cell *matHeaderCellDef class="text-right">Total</th><td mat-cell *matCellDef="let item" class="text-right font-semibold">{{item.totalVenta | currency:'COP':'symbol':'1.0-0'}}</td></ng-container>
                    <tr mat-header-row *matHeaderRowDef="displayedColumnsVentas"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumnsVentas;"></tr>
                </table>
            </div>
        </div>

        <div>
            <h2 class="text-xl font-semibold mb-4">Detalle de Salidas de Dinero</h2>
            <div class="mat-elevation-z2 rounded-lg overflow-hidden bg-white mb-6">
                <table mat-table [dataSource]="compras()">
                    <caption class="text-left p-2 font-medium bg-gray-100">Compras</caption>
                    <ng-container matColumnDef="id"><th mat-header-cell *matHeaderCellDef>ID</th><td mat-cell *matCellDef="let item">#{{item.id}}</td></ng-container>
                    <ng-container matColumnDef="fecha"><th mat-header-cell *matHeaderCellDef>Fecha</th><td mat-cell *matCellDef="let item">{{item.fecha | date:'short'}}</td></ng-container>
                    <ng-container matColumnDef="totalCompra"><th mat-header-cell *matHeaderCellDef class="text-right">Total</th><td mat-cell *matCellDef="let item" class="text-right font-semibold">{{item.totalCompra | currency:'COP':'symbol':'1.0-0'}}</td></ng-container>
                    <tr mat-header-row *matHeaderRowDef="displayedColumnsCompras"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumnsCompras;"></tr>
                </table>
            </div>
            <div class="mat-elevation-z2 rounded-lg overflow-hidden bg-white">
                 <table mat-table [dataSource]="egresos()">
                    <caption class="text-left p-2 font-medium bg-gray-100">Egresos Varios</caption>
                    <ng-container matColumnDef="id"><th mat-header-cell *matHeaderCellDef>ID</th><td mat-cell *matCellDef="let item">#{{item.id}}</td></ng-container>
                    <ng-container matColumnDef="fecha"><th mat-header-cell *matHeaderCellDef>Fecha</th><td mat-cell *matCellDef="let item">{{item.fecha | date:'short'}}</td></ng-container>
                     <ng-container matColumnDef="concepto"><th mat-header-cell *matHeaderCellDef>Concepto</th><td mat-cell *matCellDef="let item">{{item.concepto}}</td></ng-container>
                    <ng-container matColumnDef="monto"><th mat-header-cell *matHeaderCellDef class="text-right">Monto</th><td mat-cell *matCellDef="let item" class="text-right font-semibold">{{item.monto | currency:'COP':'symbol':'1.0-0'}}</td></ng-container>
                    <tr mat-header-row *matHeaderRowDef="displayedColumnsEgresos"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumnsEgresos;"></tr>
                </table>
            </div>
        </div>
    </div>
</div>